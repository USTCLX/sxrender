!function(t,s){"object"==typeof exports&&"undefined"!=typeof module?module.exports=s():"function"==typeof define&&define.amd?define(s):t.SXRender=s()}(this,function(){"use strict";var t=function(t){var s,i,e;return s=t.clientX,i=t.clientY,e=t.target.getBoundingClientRect(),{x:Math.round(s-e.x),y:Math.round(i-e.y)}},s=function(t,s,i){for(var e=null,n=s,h=0,r=t.length;h<r;h++)if(!0===(e=t[h]).draggable)switch(e.type){case"ball":if(n.x>e.x+i.x-e.radius&&n.x<e.x+i.x+e.radius&&n.y>e.y+i.y-e.radius&&n.y<e.y+i.y+e.radius)return e.id;break;case"rect":if(n.x>e.x+i.x&&n.x<e.x+i.x+e.w&&n.y>e.y+i.y&&n.y<e.y+i.y+e.h)return e.id;break;case"image":return e.id;default:return 0}},i=function(t,s){return t>0?Math.round((1-1/(.55*t/s+1))*s):-Math.round((1-1/(.55*-t/s+1))*s)},e=500;function n(t){if(this.dragging)this.dragging=!1,this.selectObjId=0;else if(this.scratching){this.scratching=!1,clearInterval(this._ticker);var s=0,i=0;0!==this.springOffset.y?(clearInterval(this._animation),this._animation=setInterval(function(){Math.abs(this.springOffset.y)>1e-4?(i=this._springTimeFun(s/1e3),s+=16,this.springOffset.y=(1-i)*this.springOffset.y,this.reRender()):(this.springOffset.y=0,this.reRender(),clearInterval(this._animation),this._animation=null,s=null,i=null)}.bind(this),16)):(this._contentVelcoity.y>30||this._contentVelcoity.y<-30)&&(this._amplitude.y=.8*this._contentVelcoity.y,this._timeStamp=Date.now(),this._targetPos.y=Math.round(this.contentOffset.y+this._amplitude.y),requestAnimationFrame(function t(){var s,i;s=Date.now()-this._timeStamp;i=-this._amplitude.y*Math.exp(-s/e);this.contentOffset.y>0?(this.contentOffset.y=0,this._contentVelcoity.y=this._amplitude.y/e*Math.exp(-s/e)):this.contentOffset.y<this.height-this.contentH?this.contentOffset.y=this.height-this.contentH:(this._amplitude.y||this._amplitude.x)&&(i>.5||i<-.5?(this.contentOffset.y=this._targetPos.y+i,requestAnimationFrame(t.bind(this))):this.contentOffset.y=this._targetPos.y);this.reRender()}.bind(this)))}}var h=function(t){var s,i,e,n,h,r,o,a,c;e=(t=t||{}).id||"",n=t.w,h=t.h,r=t.backgroundColor||"",o=t.contentW||n,a=t.contentH||h,c=t.drawScrollBar||!1,(s=e?document.getElementById(e):document.createElement("canvas")).style.backgroundColor=r||"rgba(0,0,0,0)",s.width=n||500,s.height=h||500,i=s.getContext("2d"),this.init(s,i,o,a,c)};return Object.assign(h.prototype,{init:function(e,h,r,o,a){this.canvas=e,this.ctx=h,this.width=e.width,this.height=e.height,this.dragging=!1,this.scratching=!1,this.selectObjId=0,this.contentW=r,this.contentH=o,this.drawScrollBar=a,this.backgroundImg={},this.mouseDownPos={x:0,y:0},this.springOffset={x:0,y:0},this.contentOffset={x:0,y:0},this.objs=[],this._springTimeFun=function(t,s,i,e){var n,h,r,o,a,c,d=t,g=d*d-4*s;a=(e||0)-1,c=i;var u,f;return g>0?(g=Math.sqrt(g),u=(c-(h=.5*(-d-g))*a)/((n=.5*(-d+g))-h),f=(c-n*a)/(h-n),function(t){return u*Math.exp(n*t)+f*Math.exp(h*t)+1}):0==g?(f=c-(u=a)*(n=.5*-d),function(t){return(u+f*t)*Math.exp(n*t)+1}):(g=Math.sqrt(-g),u=a,f=(c-(r=.5*-d)*a)/(o=.5*g),function(t){return(u*Math.cos(o*t)+f*Math.sin(o*t))*Math.exp(r*t)+1})}(12,180,0),this._animation=null,this._contentVelcoity={y:0,x:0},this._amplitude={y:0,x:0},this._frame={x:0,y:0},this._targetPos={x:0,y:0},this._ticker=null,this._timeStamp=0,this.canvas.addEventListener("mousedown",function(i){var e=t(i);this.selectObjId=s(this.objs,e,this.contentOffset),this.mouseDownPos=e,this.selectObjId?this.dragging=!0:(this.scratching=!0,clearInterval(this._animation),clearInterval(this._ticker),this._contentVelcoity.y=0,this._contentVelcoity.x=0,this._amplitude.y=0,this._amplitude.x=0,this._timeStamp=Date.now(),this._frame.y=e.y,this._ticker=setInterval(function(){var t,s,i,e;s=(t=Date.now())-this._timeStamp,this._timeStamp=t,i=this.mouseDownPos.y-this._frame.y,this._frame.y=this.mouseDownPos.y,e=1e3*i/(1+s),this._contentVelcoity.y=.8*e+.2*this._contentVelcoity.y}.bind(this),50))}.bind(this),!1),this.canvas.addEventListener("mouseup",n.bind(this),!1),this.canvas.addEventListener("mousemove",function(s){var e,n,h={x:0,y:0};n=t(s),this.dragging?(h.x=n.x-this.mouseDownPos.x,h.y=n.y-this.mouseDownPos.y,this.mouseDownPos.x=n.x,this.mouseDownPos.y=n.y,(e=this.findObjById(this.selectObjId)).x+=h.x,e.y+=h.y,this.reRender()):this.scratching&&(h.x=n.x-this.mouseDownPos.x,h.y=n.y-this.mouseDownPos.y,h.y<0?this.contentOffset.y<=this.height-this.contentH?(this.contentOffset.y=Math.floor(this.height-this.contentH),this.springOffset.y=i(h.y,this.height)):(this.mouseDownPos.x=n.x,this.mouseDownPos.y=n.y,this.contentOffset.y+=h.y):this.contentOffset.y>=0?(this.contentOffset.y=0,this.springOffset.y=i(h.y,this.height)):(this.mouseDownPos.x=n.x,this.mouseDownPos.y=n.y,this.contentOffset.y+=h.y),this.reRender())}.bind(this),!1),this.canvas.addEventListener("mouseout",n.bind(this),!1)},drawBackground:function(t){t&&(this.backgroundImg.content=t.imgObj,this.backgroundImg.sx=t.sx||0,this.backgroundImg.sy=t.sy||0,this.backgroundImg.sw=t.sw||0,this.backgroundImg.sh=t.sh||0,this.backgroundImg.dx=t.dx||0,this.backgroundImg.dy=t.dy||0,this.backgroundImg.dw=t.dw||this.width,this.backgroundImg.dh=t.dh||this.height),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.backgroundImg.content&&(this.backgroundImg.sw&&this.backgroundImg.sh?this.ctx.drawImage(this.backgroundImg.content,this.backgroundImg.sx,this.backgroundImg.sy,this.backgroundImg.sw,this.backgroundImg.sh,this.backgroundImg.dx,this.backgroundImg.dy,this.backgroundImg.dw,this.backgroundImg.dh):this.ctx.drawImage(this.backgroundImg.content,this.backgroundImg.dx,this.backgroundImg.dy,this.backgroundImg.dw,this.backgroundImg.dh),this.ctx.restore())},drawBall:function(t){t=t||{};var s,i,e,n,h=0*Math.PI,r=2*Math.PI;s=t.x+this.springOffset.x,i=t.y+this.springOffset.y,e=t.radius,n=t.color,this.ctx.save(),this.ctx.beginPath(),this.ctx.fillStyle=n,this.ctx.arc(s,i,e,h,r,!1),this.ctx.fill(),this.ctx.closePath(),this.ctx.restore()},clearCtx:function(t){var s,i,e,n;s=(t=t||{}).x||0,i=t.y||0,e=t.w||this.width,n=t.h||this.height,this.ctx.clearRect(s,i,e,n)},drawRect:function(t){var s,i,e,n,h;s=(t=t||{}).x+this.springOffset.x,i=t.y+this.springOffset.y,e=t.w,n=t.h,h=t.color,this.ctx.save(),this.ctx.fillStyle=h,this.ctx.fillRect(s,i,e,n),this.ctx.restore()},drawImage:function(t){var s,i,e,n,h,r,o,a,c;s=(t=t||{}).imgObj,i=t.x||0,e=t.y||0,n=t.w,h=t.h,r=t.dx||0,o=t.dy||0,a=t.dw||0,c=t.dh||0,this.ctx.save(),a&&c?this.ctx.drawImage(s,i,e,n,h,r,o,a,c):n&&h?(i+=this.springOffset.x,e+=this.springOffset.y,this.ctx.drawImage(s,i,e,n,h)):this.ctx.drawImage(s,i,e),this.ctx.restore()},reRender:function(){this.clearCtx(),this.backgroundImg.content&&this.drawBackground(),this.ctx.setTransform(1,0,0,1,this.contentOffset.x,this.contentOffset.y);for(var t=this.objs||[],s=0,i=t.length;s<i;s++)switch(t[s].type){case"ball":this.drawBall(t[s]);break;case"rect":this.drawRect(t[s]);break;case"image":this.drawImage(t[s]);break;default:console.log("miss in reRender")}this.drawScrollBar&&this._drawProgress()},findObjById:function(t){for(var s=0,i=this.objs.length;s<i;s++)if(this.objs[s].id===t)return this.objs[s];return null},add:function(t){var s={};s=Object.assign(s,t,{id:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxx".replace(/[xy]/g,function(t){var s=16*Math.random()|0;return("x"===t?s:3&s|8).toString(16)}).toUpperCase()}),this.objs.push(s)},_drawProgress:function(){this.ctx.setTransform(1,0,0,1,0,0);var t,s,i,e;e=this.springOffset.y>0?-this.springOffset.y:-2*this.springOffset.y,i=(i=Math.round(this.height*this.height/this.contentH)-Math.abs(this.springOffset.y))<10?10:i,t=Math.round(-this.contentOffset.y*this.height/this.contentH)+e,s=this.width-4,this.drawRect({x:s,y:t,w:4,h:i,color:"#888888"})}}),h});